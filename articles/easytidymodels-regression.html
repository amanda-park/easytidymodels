<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>easytidymodels Regression Example • easytidymodels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/darkly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="easytidymodels Regression Example">
<meta property="og:description" content="easytidymodels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">easytidymodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/easytidymodels-classification.html">easytidymodels Classification Example</a>
    </li>
    <li>
      <a href="../articles/easytidymodels-regression.html">easytidymodels Regression Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="easytidymodels-regression_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>easytidymodels Regression Example</h1>
            
      
      
      <div class="hidden name"><code>easytidymodels-regression.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="set-up-package-and-load-in-data-for-analysis">Set up package and load in data for analysis<a class="anchor" aria-label="anchor" href="#set-up-package-and-load-in-data-for-analysis"></a>
</h2>
<p>Generally, you want to set a seed so that your analysis is reproducible.</p>
<p>If easytidymodels isn’t installed you can install it through devtools, which is on Github.</p>
<p>If you want to use the dataset provided here you will need to install modeldata.</p>
<p>Parallel computing is used through the doParallel library to speed up computations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">24</span><span class="op">)</span>

<span class="co"># install.packages("devtools")</span>
<span class="co"># devtools::install_github("amanda-park/easytidymodels")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">easytidymodels</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">doParallel</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span>
<span class="co">#Use parallel compute to speed up processing time</span>
<span class="va">cores</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span>logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="va">cores</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-data-for-analysis-with-preprocessing">Prepare data for analysis with preprocessing<a class="anchor" aria-label="anchor" href="#prepare-data-for-analysis-with-preprocessing"></a>
</h2>
<p>Define your response variable and save it as resp.</p>
<p>trainTestSplit is a wrapper for rsample’s function to split your training and testing data. There is the option to split based on time dependency and to stratify on the response if you aren’t splitting based on time.</p>
<p>recipes are your model’s preprocessing steps. This varies for each data set you work with the level of preprocessing you need, so instead this portion of tidymodels has not been given a wrapper. The available preprocessing steps that you can use in recipes can be seen <a href="https://recipes.tidymodels.org/reference/index.html" class="external-link">here</a>.</p>
<p>After your recipe is set up, you can split your data into training and testing and then bake your recipe’s preprocessing steps into the model.</p>
<p>Lastly, you can set up a cross-validation fold object through the function cvFolds.</p>
<p>These objects are all necessary for fitting the variety of models that tidymodels offers you.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Define your response variable and formula object here</span>
<span class="va">resp</span> <span class="op">&lt;-</span> <span class="st">"Sale_Price"</span>
<span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">resp</span>, <span class="st">"."</span>, sep<span class="op">=</span><span class="st">"~"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Split data into training and testing sets</span>
<span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trainTestSplit.html">trainTestSplit</a></span><span class="op">(</span><span class="va">ames</span>,
                        stratifyOnResponse <span class="op">=</span> <span class="cn">TRUE</span>,
                        responseVar <span class="op">=</span> <span class="va">resp</span><span class="op">)</span>

<span class="co">#Create recipe for feature engineering for dataset, varies based on data working with</span>
<span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">split</span><span class="op">$</span><span class="va">train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html" class="external-link">step_log</a></span><span class="op">(</span><span class="va">resp</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_YeoJohnson.html" class="external-link">step_YeoJohnson</a></span><span class="op">(</span><span class="va">Lot_Area</span>, <span class="va">Gr_Liv_Area</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_other.html" class="external-link">step_other</a></span><span class="op">(</span><span class="va">Neighborhood</span>, threshold <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_zv.html" class="external-link">step_zv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_nzv.html" class="external-link">step_nzv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_corr.html" class="external-link">step_corr</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_outcomes</a></span><span class="op">(</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">train_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">rec</span>, <span class="va">split</span><span class="op">$</span><span class="va">train</span><span class="op">)</span>
<span class="va">test_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">rec</span>, <span class="va">split</span><span class="op">$</span><span class="va">test</span><span class="op">)</span>

<span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvFolds.html">cvFolds</a></span><span class="op">(</span><span class="va">train_df</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="about-all-regression-models">About all regression models<a class="anchor" aria-label="anchor" href="#about-all-regression-models"></a>
</h1>
<p>General workflow they all follow:</p>
<ul>
<li>Fit the model specified to training data</li>
<li>Create a workflow and tune hyperparameters</li>
<li>Choose optimal model based on evaluation metric chosen</li>
<li>Evaluate model performance on training and testing data</li>
</ul>
<p>Available evaluation metrics for evalMetric:</p>
<ul>
<li>
<a href="https://yardstick.tidymodels.org/reference/rmse.html" class="external-link">RMSE</a> (Root Mean Squared Error, call “rmse”)</li>
<li>
<a href="https://yardstick.tidymodels.org/reference/mae.html" class="external-link">MAE</a> (Mean Absolute Error, call “mae”)</li>
<li>
<a href="https://yardstick.tidymodels.org/reference/rsq.html" class="external-link">RSQ</a> (R-Squared, call “rsq”)</li>
<li>
<a href="https://yardstick.tidymodels.org/reference/mase.html" class="external-link">MASE</a> (Mean Absolute Scaled Error, call “mase”)</li>
<li>
<a href="https://yardstick.tidymodels.org/reference/ccc.html" class="external-link">CCC</a> (Concordance Correlation Coefficient, call “ccc”)</li>
<li>
<a href="https://yardstick.tidymodels.org/reference/iic.html" class="external-link">IIC</a> (Index of Ideality of Correlation, call “iic”)</li>
<li>
<a href="https://yardstick.tidymodels.org/reference/huber_loss.html" class="external-link">HUBER_LOSS</a> (Huber loss, call “huber_loss”)</li>
</ul>
<div class="section level2">
<h2 id="fit-a-knn-model">Fit a KNN Model<a class="anchor" aria-label="anchor" href="#fit-a-knn-model"></a>
</h2>
<p>Uses <code><a href="https://github.com/KlausVigo/kknn" class="external-link">library(kknn)</a></code> to compute model.</p>
<p>This is what the KNN model tunes:</p>
<ul>
<li>
<strong>neighbors</strong>: The number of neighbors considered at each prediction.</li>
<li>
<strong>weight_func</strong>: The type of kernel function that weights the distances between samples.</li>
<li>
<strong>dist_power</strong>: The parameter used when calculating the Minkowski distance. This corresponds to the Manhattan distance with dist_power = 1 and the Euclidean distance with dist_power = 2.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">knnReg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knnRegress.html">knnRegress</a></span><span class="op">(</span>
  recipe <span class="op">=</span> <span class="va">rec</span>,
  response <span class="op">=</span> <span class="va">resp</span>,
  folds <span class="op">=</span> <span class="va">folds</span>,
  train <span class="op">=</span> <span class="va">train_df</span>,
  test <span class="op">=</span> <span class="va">test_df</span>,
  evalMetric <span class="op">=</span> <span class="st">"rmse"</span>
<span class="op">)</span>

<span class="co">#Visualize training data and its predictions</span>
<span class="va">knnReg</span><span class="op">$</span><span class="va">trainPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for training data</span>
<span class="va">knnReg</span><span class="op">$</span><span class="va">trainScore</span>

<span class="co">#Visualize testing data and its predictions</span>
<span class="va">knnReg</span><span class="op">$</span><span class="va">testPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for testing data</span>
<span class="va">knnReg</span><span class="op">$</span><span class="va">testScore</span>

<span class="co">#See the final model chosen by KNN based on optimizing for your chosen evaluation metric</span>
<span class="va">knnReg</span><span class="op">$</span><span class="va">final</span>

<span class="co">#See how model fit looks based on another evaluation metric</span>
<span class="va">knnReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">show_best</a></span><span class="op">(</span><span class="st">"mae"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-support-vector-machine-radial-basis-kernel-model">Fit a Support Vector Machine (Radial Basis Kernel) Model<a class="anchor" aria-label="anchor" href="#fit-a-support-vector-machine-radial-basis-kernel-model"></a>
</h2>
<p>Uses <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(kernlab)</a></code> to compute SVM model.</p>
<p>What the model tunes:</p>
<ul>
<li>
<strong>cost</strong>: The cost of predicting a sample within or on the wrong side of the margin.</li>
<li>
<strong>rbf_sigma</strong>: The precision parameter for the radial basis function.</li>
<li>
<strong>margin</strong>: The epsilon in the SVM insensitive loss function (regression only)</li>
</ul>
<p>All the same evaluation methods for KNN are also available for SVM.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svmReg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svmRegress.html">svmRegress</a></span><span class="op">(</span>
  recipe <span class="op">=</span> <span class="va">rec</span>,
  response <span class="op">=</span> <span class="va">resp</span>,
  folds <span class="op">=</span> <span class="va">folds</span>,
  train <span class="op">=</span> <span class="va">train_df</span>,
  test <span class="op">=</span> <span class="va">test_df</span>,
  evalMetric <span class="op">=</span> <span class="st">"rmse"</span>
<span class="op">)</span>

<span class="co">#Visualize training data and its predictions</span>
<span class="va">svmReg</span><span class="op">$</span><span class="va">trainPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for training data</span>
<span class="va">svmReg</span><span class="op">$</span><span class="va">trainScore</span>

<span class="co">#Visualize testing data and its predictions</span>
<span class="va">svmReg</span><span class="op">$</span><span class="va">testPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for testing data</span>
<span class="va">svmReg</span><span class="op">$</span><span class="va">testScore</span>

<span class="co">#See the final model chosen by svm based on optimizing for your chosen evaluation metric</span>
<span class="va">svmReg</span><span class="op">$</span><span class="va">final</span>

<span class="co">#See how model fit looks based on another evaluation metric</span>
<span class="va">svmReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">show_best</a></span><span class="op">(</span><span class="st">"mae"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-tuned-linear-regression-model">Fit a Tuned Linear Regression Model<a class="anchor" aria-label="anchor" href="#fit-a-tuned-linear-regression-model"></a>
</h2>
<p>Uses <code><a href="https://glmnet.stanford.edu" class="external-link">library(glmnet)</a></code> to compute tuned linear regression model.</p>
<p>What the model tunes:</p>
<ul>
<li>
<strong>penalty</strong>: The total amount of regularization in the model. Also known as lambda.</li>
<li>
<strong>mixture</strong>: The mixture amounts of different types of regularization (see below). If 1, amounts to LASSO regression. If 0, amounts to Ridge Regression. Also known as alpha.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linearReg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/linearRegress.html">linearRegress</a></span><span class="op">(</span>
  recipe <span class="op">=</span> <span class="va">rec</span>,
  response <span class="op">=</span> <span class="va">resp</span>,
  folds <span class="op">=</span> <span class="va">folds</span>,
  train <span class="op">=</span> <span class="va">train_df</span>,
  test <span class="op">=</span> <span class="va">test_df</span>,
  evalMetric <span class="op">=</span> <span class="st">"rmse"</span>,
  tidyModelVersion <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co">#Visualize training data and its predictions</span>
<span class="va">linearReg</span><span class="op">$</span><span class="va">trainPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for training data</span>
<span class="va">linearReg</span><span class="op">$</span><span class="va">trainScore</span>

<span class="co">#Visualize testing data and its predictions</span>
<span class="va">linearReg</span><span class="op">$</span><span class="va">testPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for testing data</span>
<span class="va">linearReg</span><span class="op">$</span><span class="va">testScore</span>

<span class="co">#See the final model chosen by linear based on optimizing for your chosen evaluation metric</span>
<span class="va">linearReg</span><span class="op">$</span><span class="va">final</span>

<span class="co">#See how model fit looks based on another evaluation metric</span>
<span class="va">linearReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">show_best</a></span><span class="op">(</span><span class="st">"mae"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-random-forest-model">Fit a Random Forest Model<a class="anchor" aria-label="anchor" href="#fit-a-random-forest-model"></a>
</h2>
<p>Uses <code><a href="https://github.com/imbs-hl/ranger" class="external-link">library(ranger)</a></code> to compute a random forest regression model.</p>
<p>What the model tunes:</p>
<ul>
<li>
<strong>mtry</strong>: The number of predictors that will be randomly sampled at each split when creating the tree models.</li>
<li>
<strong>min_n</strong>: The minimum number of data points in a node that are required for the node to be split further.</li>
</ul>
<p>What you set specifically:</p>
<ul>
<li>
<strong>trees</strong>: Default is 100. Sets the number of trees contained in the ensemble. A larger values increases runtime but (ideally) leads to more robust outcomes.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rfReg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rfRegress.html">rfRegress</a></span><span class="op">(</span>
  recipe <span class="op">=</span> <span class="va">rec</span>,
  response <span class="op">=</span> <span class="va">resp</span>,
  folds <span class="op">=</span> <span class="va">folds</span>,
  train <span class="op">=</span> <span class="va">train_df</span>,
  test <span class="op">=</span> <span class="va">test_df</span>,
  calcFeatImp <span class="op">=</span> <span class="cn">TRUE</span>,
  evalMetric <span class="op">=</span> <span class="st">"mae"</span>
<span class="op">)</span>

<span class="co">#Visualize training data and its predictions</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">trainPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for training data</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">trainScore</span>

<span class="co">#Visualize testing data and its predictions</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">testPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for testing data</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">testScore</span>

<span class="co">#See the final model chosen by rf based on optimizing for your chosen evaluation metric</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">final</span>

<span class="co">#See how model fit looks based on another evaluation metric</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">show_best</a></span><span class="op">(</span><span class="st">"mae"</span><span class="op">)</span>

<span class="co">#See feature importance of model</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">featImpPlot</span>

<span class="co">#See numeric feature importance of model</span>
<span class="va">rfReg</span><span class="op">$</span><span class="va">featImpVars</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-an-xgboost-model">Fit an XGBoost Model<a class="anchor" aria-label="anchor" href="#fit-an-xgboost-model"></a>
</h2>
<p>Uses <code><a href="https://github.com/dmlc/xgboost" class="external-link">library(xgboost)</a></code> to compute a random forest regression model.</p>
<p>What the model tunes:</p>
<ul>
<li>
<strong>mtry</strong>: The number of predictors that will be randomly sampled at each split when creating the tree models.</li>
<li>
<strong>min_n</strong>: The minimum number of data points in a node that are required for the node to be split further.</li>
<li>
<strong>tree_depth</strong>: The maximum depth of the tree (i.e. number of splits).</li>
<li>
<strong>learn_rate</strong>: The rate at which the boosting algorithm adapts from iteration-to-iteration.</li>
<li>
<strong>loss_reduction</strong>: The reduction in the loss function required to split further.</li>
<li>
<strong>sample_size</strong>: The amount of data exposed to the fitting routine.</li>
</ul>
<p>What you set specifically:</p>
<ul>
<li>
<strong>trees</strong>: Default is 100. Sets the number of trees contained in the ensemble. A larger values increases runtime but (ideally) leads to more robust outcomes.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xgReg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/xgRegress.html">xgRegress</a></span><span class="op">(</span>
  recipe <span class="op">=</span> <span class="va">rec</span>,
  response <span class="op">=</span> <span class="va">resp</span>,
  folds <span class="op">=</span> <span class="va">folds</span>,
  train <span class="op">=</span> <span class="va">train_df</span>,
  test <span class="op">=</span> <span class="va">test_df</span>,
  calcFeatImp <span class="op">=</span> <span class="cn">TRUE</span>,
  evalMetric <span class="op">=</span> <span class="st">"mae"</span>
<span class="op">)</span>

<span class="co">#Visualize training data and its predictions</span>
<span class="va">xgReg</span><span class="op">$</span><span class="va">trainPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for training data</span>
<span class="va">xgReg</span><span class="op">$</span><span class="va">trainScore</span>

<span class="co">#Visualize testing data and its predictions</span>
<span class="va">xgReg</span><span class="op">$</span><span class="va">testPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for testing data</span>
<span class="va">xgReg</span><span class="op">$</span><span class="va">testScore</span>

<span class="co">#See the final model chosen by xg based on optimizing for your chosen evaluation metric</span>
<span class="va">xgReg</span><span class="op">$</span><span class="va">final</span>

<span class="co">#See how model fit looks based on another evaluation metric</span>
<span class="va">xgReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">select_best</a></span><span class="op">(</span><span class="st">"rmse"</span><span class="op">)</span>

<span class="co">#See feature importance of model</span>
<span class="va">xgReg</span><span class="op">$</span><span class="va">featImpPlot</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-a-mars-model">Fit a MARS Model<a class="anchor" aria-label="anchor" href="#fit-a-mars-model"></a>
</h2>
<p>Uses <code><a href="http://www.milbo.users.sonic.net/earth/" class="external-link">library(earth)</a></code> to compute a multi-adaptive regressive spline model.</p>
<p>What the model tunes:</p>
<ul>
<li>
<strong>num_terms</strong>: The number of features that will be retained in the final model.</li>
<li>
<strong>prod_degree</strong>: The highest possible degree of interaction between features. A value of 1 indicates an additive model while a value of 2 allows, but does not guarantee, two-way interactions between features.</li>
<li>
<strong>prune_method</strong>: The type of pruning. Possible values are listed in ?earth.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">marsReg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marsRegress.html">marsRegress</a></span><span class="op">(</span>
  recipe <span class="op">=</span> <span class="va">rec</span>,
  response <span class="op">=</span> <span class="va">resp</span>,
  folds <span class="op">=</span> <span class="va">folds</span>,
  train <span class="op">=</span> <span class="va">train_df</span>,
  test <span class="op">=</span> <span class="va">test_df</span>,
  evalMetric <span class="op">=</span> <span class="st">"rmse"</span>
<span class="op">)</span>

<span class="co">#Visualize training data and its predictions</span>
<span class="va">marsReg</span><span class="op">$</span><span class="va">trainPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for training data</span>
<span class="va">marsReg</span><span class="op">$</span><span class="va">trainScore</span>

<span class="co">#Visualize testing data and its predictions</span>
<span class="va">marsReg</span><span class="op">$</span><span class="va">testPred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.pred</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span>

<span class="co">#View how model metrics for RMSE, R-Squared, and MAE look for testing data</span>
<span class="va">marsReg</span><span class="op">$</span><span class="va">testScore</span>

<span class="co">#See the final model chosen by mars based on optimizing for your chosen evaluation metric</span>
<span class="va">marsReg</span><span class="op">$</span><span class="va">final</span>

<span class="co">#See how model fit looks based on another evaluation metric</span>
<span class="va">marsReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">show_best</a></span><span class="op">(</span><span class="st">"mae"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-stacking-example">Model Stacking Example<a class="anchor" aria-label="anchor" href="#model-stacking-example"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://parsnip.tidymodels.org" class="external-link">parsnip</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/tune" class="external-link">tune</a></span><span class="op">)</span>

<span class="co"># Finalize parameters </span>

<span class="va">rfParam</span> <span class="op">&lt;-</span> <span class="va">rfReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">show_best</a></span><span class="op">(</span><span class="st">"rmse"</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mtry</span>, <span class="va">min_n</span><span class="op">)</span>

<span class="va">xgParam</span> <span class="op">&lt;-</span> <span class="va">xgReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html" class="external-link">show_best</a></span><span class="op">(</span><span class="st">"rmse"</span>, n<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mtry</span><span class="op">:</span><span class="va">sample_size</span><span class="op">)</span>

<span class="co"># Collect model predictions to stack</span>

<span class="va">xgStack</span> <span class="op">&lt;-</span> <span class="va">xgReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">xgParam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">.row</span>, <span class="op">!</span><span class="op">!</span><span class="va">resp</span>, xgboost <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span>

<span class="va">rfStack</span> <span class="op">&lt;-</span> <span class="va">rfReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">rfParam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">.row</span>, randomforest <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span>

<span class="va">marsStack</span> <span class="op">&lt;-</span> <span class="va">marsReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">.row</span>, mars <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span>

<span class="va">knnStack</span> <span class="op">&lt;-</span> <span class="va">knnReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">.row</span>, knn <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span>

<span class="va">svmStack</span> <span class="op">&lt;-</span> <span class="va">svmReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">.row</span>, svm <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span>

<span class="va">lmStack</span> <span class="op">&lt;-</span> <span class="va">linearReg</span><span class="op">$</span><span class="va">tune</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_predictions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">.row</span>, lm <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span>

<span class="va">stackDat</span> <span class="op">&lt;-</span> <span class="va">xgStack</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">rfStack</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">marsStack</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">knnStack</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">svmStack</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">lmStack</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span>, <span class="op">-</span><span class="va">.row</span><span class="op">)</span>

<span class="va">stackModel</span> <span class="op">&lt;-</span> <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fl">.2</span>, mixture <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"glmnet"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">formula</span>, data <span class="op">=</span> <span class="va">stackDat</span><span class="op">)</span>

<span class="va">stackModel</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">#Finalize model fits</span>

<span class="va">xgFinal</span> <span class="op">&lt;-</span> <span class="va">xgReg</span><span class="op">$</span><span class="va">final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html" class="external-link">last_fit</a></span><span class="op">(</span><span class="va">split</span><span class="op">$</span><span class="va">split</span><span class="op">)</span>
<span class="va">rfFinal</span> <span class="op">&lt;-</span> <span class="va">rfReg</span><span class="op">$</span><span class="va">final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html" class="external-link">last_fit</a></span><span class="op">(</span><span class="va">split</span><span class="op">$</span><span class="va">split</span><span class="op">)</span>
<span class="va">marsFinal</span> <span class="op">&lt;-</span> <span class="va">marsReg</span><span class="op">$</span><span class="va">final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html" class="external-link">last_fit</a></span><span class="op">(</span><span class="va">split</span><span class="op">$</span><span class="va">split</span><span class="op">)</span>
<span class="va">knnFinal</span> <span class="op">&lt;-</span> <span class="va">knnReg</span><span class="op">$</span><span class="va">final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html" class="external-link">last_fit</a></span><span class="op">(</span><span class="va">split</span><span class="op">$</span><span class="va">split</span><span class="op">)</span>
<span class="va">svmFinal</span> <span class="op">&lt;-</span> <span class="va">svmReg</span><span class="op">$</span><span class="va">final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html" class="external-link">last_fit</a></span><span class="op">(</span><span class="va">split</span><span class="op">$</span><span class="va">split</span><span class="op">)</span>
<span class="va">lmFinal</span> <span class="op">&lt;-</span> <span class="va">linearReg</span><span class="op">$</span><span class="va">final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tune.tidymodels.org/reference/last_fit.html" class="external-link">last_fit</a></span><span class="op">(</span><span class="va">split</span><span class="op">$</span><span class="va">split</span><span class="op">)</span>

<span class="va">stackFinal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  <span class="st">"model"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    <span class="va">xgFinal</span>, <span class="va">rfFinal</span>, <span class="va">marsFinal</span>, <span class="va">knnFinal</span>, <span class="va">svmFinal</span>, <span class="va">lmFinal</span>
    <span class="op">)</span>,
  <span class="st">"model_names"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="st">"xgboost"</span>, <span class="st">"randomforest"</span>, <span class="st">"mars"</span>, <span class="st">"knn"</span>, <span class="st">"svm"</span>, <span class="st">"lm"</span>
    <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">collect_predictions</span><span class="op">)</span><span class="op">)</span>

<span class="va">stackFinal</span> <span class="op">&lt;-</span> <span class="va">stackFinal</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">model_names</span>, <span class="va">pred</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">model_names</span>, values_from <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span>, <span class="op">-</span><span class="va">.row</span>, <span class="op">-</span><span class="va">.config</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">stackModel</span>, <span class="va">stackFinal</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">stackFinal</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"stack"</span> <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="op">!</span><span class="op">!</span><span class="va">resp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/rmse.html" class="external-link">rmse</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="op">!</span><span class="op">!</span><span class="va">resp</span>, estimate <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">.metric</span>, values_from <span class="op">=</span> <span class="va">.estimate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Amanda Park.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
